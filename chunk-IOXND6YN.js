import{a as $}from"./chunk-LNVPENB4.js";import{a as Z}from"./chunk-VS4EENRH.js";import{a as Y}from"./chunk-CJL2YRPP.js";import{a as A}from"./chunk-JC5442BX.js";import{e as D,g as N}from"./chunk-YNLNNLDO.js";import{b as B,c as P,d as k,e as L,f as Q,g as O,h as j,i as G,j as H,k as J,l as K,m as X}from"./chunk-HZ2NMNNL.js";import"./chunk-N7HB2IBM.js";import{$ as g,Ba as l,Fb as C,Gb as d,Ib as E,Jb as q,Kb as F,Lb as x,Mb as f,Nb as h,Oa as W,Ta as _,U as v,aa as u,db as b,ib as s,kb as M,lb as S,mb as y,nb as o,ob as n,pb as R,tb as I,ub as w,vb as m,za as z}from"./chunk-L66XQOBG.js";function ee(i,c){i&1&&(o(0,"small",24),d(1,"Il titolo \xE8 obbligatorio"),n())}function te(i,c){if(i&1&&_(0,ee,2,0,"small",24),i&2){m();let e=C(10);s(e.errors!=null&&e.errors.required?0:-1)}}function ie(i,c){i&1&&(o(0,"small",24),d(1,"Il tempo di cottura \xE8 obbligatorio"),n())}function ne(i,c){if(i&1&&_(0,ie,2,0,"small",24),i&2){m();let e=C(20);s(e.errors!=null&&e.errors.required?0:-1)}}function oe(i,c){i&1&&(o(0,"small",24),d(1,"Il numero di porzioni \xE8 obbligatorio"),n())}function ae(i,c){if(i&1&&_(0,oe,2,0,"small",24),i&2){m();let e=C(26);s(e.errors!=null&&e.errors.required?0:-1)}}function re(i,c){if(i&1&&(o(0,"option",23),d(1),n()),i&2){let e=c.$implicit;b("ngValue",e.id),l(),E(" ",e.name," ")}}function le(i,c){i&1&&(o(0,"small",24),d(1,"La categoria \xE8 obbligatoria"),n())}function de(i,c){if(i&1&&(o(0,"option",23),d(1),n()),i&2){let e=c.$implicit;b("ngValue",e.id),l(),E(" ",e.name," ")}}function ce(i,c){i&1&&(o(0,"small",24),d(1,"Il tipo di alimentazione \xE8 obbligatorio"),n())}function me(i,c){if(i&1&&(o(0,"option",31),d(1),n()),i&2){let e=c.$implicit;b("value",e.id),l(),E(" ",e.name," ")}}function se(i,c){i&1&&(o(0,"small",24),d(1,"Aggiungi almeno un ingrediente"),n())}function pe(i,c){if(i&1&&(o(0,"span"),d(1),n()),i&2){let e=m().$implicit;l(),E(" ",e.ingredienteNome," ")}}function ge(i,c){if(i&1&&(o(0,"span"),d(1),n()),i&2){let e=m().$implicit;l(),F(" ",e.ingredienteNome," - ",e.quantita," ",e.unitaMisura," ")}}function ue(i,c){if(i&1&&(o(0,"span"),d(1),n()),i&2){let e=m().$implicit;l(),q(" ",e.ingredienteNome," ",e.unitaMisura," ")}}function _e(i,c){if(i&1){let e=I();o(0,"li",36),_(1,pe,2,1,"span")(2,ge,2,3,"span")(3,ue,2,2,"span"),o(4,"button",43),w("click",function(){let t=g(e).$implicit,r=m(2);return u(r.removeIngredient(t.ingredienteNome))}),R(5,"i",44),n()()}if(i&2){let e=c.$implicit;l(),s((e.quantita==null||e.quantita==0)&&(e.unitaMisura==null||e.unitaMisura=="")?1:-1),l(),s(e.quantita&&e.quantita!==0?2:-1),l(),s(e.unitaMisura&&e.unitaMisura!==""&&e.quantita==null||e.quantita==0?3:-1)}}function Ce(i,c){i&1&&(o(0,"small",24),d(1,"Aggiungi almeno uno step"),n())}function xe(i,c){if(i&1&&(o(0,"div",9),R(1,"img",45),n()),i&2){let e=m(2);l(),b("src","data:image/jpeg;base64,"+e.model.immagineUrl,z)}}function fe(i,c){if(i&1){let e=I();o(0,"div")(1,"h1",8),d(2,"Aggiorna ricetta esistente"),n(),o(3,"div",9)(4,"form",10,0),w("ngSubmit",function(){g(e);let t=C(5),r=m();return u(r.onSubmit(t))}),o(6,"div",11)(7,"label",12),d(8,"Titolo"),n(),o(9,"input",13,1),h("ngModelChange",function(t){g(e);let r=m();return f(r.model.titolo,t)||(r.model.titolo=t),u(t)}),n(),_(11,te,1,1),n(),o(12,"div",11)(13,"label",14),d(14,"Descrizione"),n(),o(15,"input",15),h("ngModelChange",function(t){g(e);let r=m();return f(r.model.descrizione,t)||(r.model.descrizione=t),u(t)}),n()(),o(16,"div",11)(17,"label",16),d(18,"Tempo di cottura"),n(),o(19,"input",17,2),h("ngModelChange",function(t){g(e);let r=m();return f(r.model.tempocottura,t)||(r.model.tempocottura=t),u(t)}),n(),_(21,ne,1,1),n(),o(22,"div",11)(23,"label",18),d(24,"Porzioni"),n(),o(25,"input",19,3),h("ngModelChange",function(t){g(e);let r=m();return f(r.model.porzioni,t)||(r.model.porzioni=t),u(t)}),n(),_(27,ae,1,1),n(),o(28,"div",11)(29,"label",20),d(30,"Categoria"),n(),o(31,"select",21,4),h("ngModelChange",function(t){g(e);let r=m();return f(r.model.categoriaid,t)||(r.model.categoriaid=t),u(t)}),o(33,"option",22),d(34,"Seleziona una categoria"),n(),S(35,re,2,2,"option",23,M),n(),_(37,le,2,0,"small",24),n(),o(38,"div",11)(39,"label",25),d(40,"Tipo di alimentazione"),n(),o(41,"select",26,5),h("ngModelChange",function(t){g(e);let r=m();return f(r.model.alimentazioneid,t)||(r.model.alimentazioneid=t),u(t)}),o(43,"option",22),d(44,"Seleziona una alimentazione"),n(),S(45,de,2,2,"option",23,M),n(),_(47,ce,2,0,"small",24),n(),o(48,"div",11)(49,"label",27),d(50,"Ingredienti"),n(),o(51,"div",28)(52,"select",29),h("ngModelChange",function(t){g(e);let r=m();return f(r.selectedIngredient,t)||(r.selectedIngredient=t),u(t)}),o(53,"option",30),d(54,"Seleziona un ingrediente"),n(),S(55,me,2,2,"option",31,M),n(),o(57,"input",32),h("ngModelChange",function(t){g(e);let r=m();return f(r.ingredientQuantity,t)||(r.ingredientQuantity=t),u(t)}),n(),o(58,"input",33),h("ngModelChange",function(t){g(e);let r=m();return f(r.ingredientMeasure,t)||(r.ingredientMeasure=t),u(t)}),n(),o(59,"button",34),w("click",function(){g(e);let t=m();return u(t.addIngredient())}),d(60," + "),n()(),_(61,se,2,0,"small",24),o(62,"ul",35),S(63,_e,6,3,"li",36,M),n()(),o(65,"div",11)(66,"label",37),d(67,"Procedimento"),n(),o(68,"textarea",38,6),h("ngModelChange",function(t){g(e);let r=m();return f(r.model.procedimento,t)||(r.model.procedimento=t),u(t)}),n(),_(70,Ce,2,0,"small",24),n(),o(71,"div",11)(72,"label",39),d(73,"Carica un'immagine:"),n(),o(74,"input",40),w("change",function(t){g(e);let r=m();return u(r.onFileSelected(t))}),n(),_(75,xe,2,1,"div",9),n(),o(76,"button",41),R(77,"i",42),d(78,"Aggiorna"),n()()()()}if(i&2){let e=C(5),a=C(10),t=C(20),r=C(26),T=C(32),U=C(42),V=C(69),p=m();l(9),x("ngModel",p.model.titolo),l(2),s(a.invalid&&(a.touched||e.submitted)?11:-1),l(4),x("ngModel",p.model.descrizione),l(4),x("ngModel",p.model.tempocottura),l(2),s(t.invalid&&(t.touched||e.submitted)?21:-1),l(4),x("ngModel",p.model.porzioni),l(2),s(r.invalid&&(r.touched||e.submitted)?27:-1),l(4),x("ngModel",p.model.categoriaid),l(2),b("ngValue",void 0),l(2),y(p.availableCategories),l(2),s(T.invalid&&(T.touched||e.submitted)?37:-1),l(4),x("ngModel",p.model.alimentazioneid),l(2),b("ngValue",void 0),l(2),y(p.availableDiets),l(2),s(U.invalid&&(U.touched||e.submitted)?47:-1),l(5),x("ngModel",p.selectedIngredient),l(),b("ngValue",void 0),l(2),y(p.availableIngredients),l(2),x("ngModel",p.ingredientQuantity),l(),x("ngModel",p.ingredientMeasure),l(3),s(p.model.ingredientiquantita.length==0&&e.submitted?61:-1),l(2),y(p.model.ingredientiquantita),l(5),x("ngModel",p.model.procedimento),l(2),s(V.invalid&&(V.touched||e.submitted)?70:-1),l(5),s(p.model.immagineUrl?75:-1)}}function he(i,c){i&1&&(o(0,"div")(1,"p"),d(2,"Loading..."),n()())}var Ue=(()=>{class i{removeIngredient(e){if(e){let a=this.model.ingredientiquantita.findIndex(t=>t.ingredienteNome===e);a!==-1&&this.model?.ingredientiquantita.splice(a,1)}}onFileSelected(e){let a=e.target.files[0];if(console.log(a),a){let t=new FileReader;t.onload=r=>{this.model.immagineUrl=r.target.result.split(",")[1]},t.readAsDataURL(a)}else this.model.immagineUrl=""}addIngredient(){console.log("Adding ingredient"),console.log(this.availableIngredients.find(e=>e.id==this.selectedIngredient).name),this.selectedIngredient&&(this.model?.ingredientiquantita.push({ingredienteId:this.selectedIngredient,quantita:this.ingredientQuantity,ingredienteNome:this.availableIngredients.find(e=>e.id==this.selectedIngredient).name,unitaMisura:this.ingredientMeasure}),this.selectedIngredient=void 0,this.ingredientQuantity=null,this.ingredientMeasure="")}onSubmit(e){if(console.log("Form submitted",e.value),e.invalid){console.error("Form is invalid",e.errors);return}console.log("Form is valid",e.value),this.model&&(this.updateRecipeSubscription=this.recipeService.updateRecipe(this.model).subscribe({next:()=>{console.log("Recipe updated"),this.router.navigate(["/admin/recipes"])},error:a=>{console.error("Error updating recipe",a)}}))}constructor(){this.ingredientService=v(Y),this.recipeService=v(A),this.router=v(N),this.route=v(D),this.categoryService=v(Z),this.dietService=v($),this.availableIngredients=[],this.availableCategories=[],this.availableDiets=[],this.selectedIngredient=void 0,this.ingredientQuantity=null,this.ingredientMeasure="",this.imageUrl=null,this.getRecipeModel=void 0,this.recipeId=null,this.model={id:"",titolo:"",descrizione:"",tempocottura:0,porzioni:0,procedimento:"",immagineUrl:"",categoriaid:0,alimentazioneid:0,ingredientiquantita:[]}}ngOnInit(){this.recipeId=this.route.snapshot.paramMap.get("id"),this.recipeId&&(this.loadIngredients(),this.loadAvailableCategories(),this.loadAvailableDiets(),this.loadRecipe(this.recipeId))}loadRecipe(e){this.getDetailsSubscription=this.recipeService.getRecipeDetails(e).subscribe({next:a=>{console.log("Recipe loaded"),console.log(a),this.getRecipeModel=a,this.model.id=this.getRecipeModel.id,this.model.titolo=this.getRecipeModel.titolo,this.model.descrizione=this.getRecipeModel.descrizione,this.model.tempocottura=this.getRecipeModel.tempocottura,this.model.porzioni=this.getRecipeModel.porzioni,this.model.procedimento=this.getRecipeModel.procedimento,this.model.immagineUrl=this.getRecipeModel.immagineurl,this.model.categoriaid=this.availableCategories.find(t=>t.name==this.getRecipeModel?.categorianome).id,this.model.alimentazioneid=this.availableDiets.find(t=>t.name==this.getRecipeModel?.alimentazionenome).id,this.model.ingredientiquantita=this.getRecipeModel?.ingredientiQuantita.map(t=>({ingredienteId:t.ingredienteId,quantita:t.quantita,ingredienteNome:t.ingredienteNome,unitaMisura:t.unitaMisura}))},error:a=>{console.error("Error loading recipe",a)}})}loadIngredients(){this.getIngredientsSubscription=this.ingredientService.getIngredients().subscribe({next:e=>{console.log("Ingredients loaded"),console.log(e),this.availableIngredients=e.sort((a,t)=>a.name.localeCompare(t.name))},error:e=>{console.error("Error loading ingredients",e)}})}loadAvailableCategories(){this.categoryService.getCategories().subscribe(e=>{this.availableCategories=e.sort((a,t)=>a.name.localeCompare(t.name))},e=>{console.error("Error fetching categories",e)})}loadAvailableDiets(){this.dietService.getDiets().subscribe(e=>{this.availableDiets=e.sort((a,t)=>a.name.localeCompare(t.name))},e=>{console.error("Error fetching categories",e)})}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=W({type:i,selectors:[["app-update-recipe"]],decls:3,vars:2,consts:[["form","ngForm"],["titolo","ngModel"],["tempocottura","ngModel"],["porzioni","ngModel"],["categoriaid","ngModel"],["alimentazioneid","ngModel"],["steps","ngModel"],[1,"container"],[1,"mt-3","text-center","text-orange"],[1,"mt-3"],[3,"ngSubmit"],[1,"mb-3"],["for","title",1,"form-label","text-bold","text-orange"],["type","text","id","recipeTitle","name","recipeTitle","placeholder","Inserisci il titolo","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","description",1,"form-label","text-bold","text-orange"],["type","text","id","description","name","description","placeholder","Inserisci la descrizione",1,"form-control",3,"ngModelChange","ngModel"],["for","cookTime",1,"form-label","text-bold","text-orange"],["type","text","id","cookTime","name","cookTime","placeholder","Inserisci il tempo di cottura","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","servings",1,"form-label","text-bold","text-orange"],["type","number","id","servings","name","servings","placeholder","Inserisci il numero di porzioni","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","categories",1,"form-label","text-bold","text-orange"],["name","categoriaid","required","",1,"form-select",3,"ngModelChange","ngModel"],["disabled","","selected","",3,"ngValue"],[3,"ngValue"],[1,"text-red"],["for","diet",1,"form-label","text-bold","text-orange"],["name","alimentazioneid","required","",1,"form-select",3,"ngModelChange","ngModel"],["for","ingredients",1,"form-label","text-bold","text-orange"],[1,"input-group","mb-3"],["name","selectedIngredient",1,"form-select",3,"ngModelChange","ngModel"],["disabled","",3,"ngValue"],[3,"value"],["type","text","placeholder","Quantit\xE0","name","ingredientQuantity",1,"form-control",3,"ngModelChange","ngModel"],["type","text","placeholder","Unit\xE0 di misura","name","ingredientMeasure",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"list-group"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"],["for","steps",1,"form-label","text-bold","text-orange"],["id","steps","name","steps","placeholder","Descrivi i vari step separandoli da un punto e virgola","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-label","text-bold","text-orange"],["type","file","accept","image/*",1,"form-control",3,"change"],["type","submit",1,"btn","btn-light","border-orange","mb-3"],[1,"bi","bi-pencil","me-2"],["type","button",1,"btn","btn-light","btn-sm",3,"click"],[1,"bi","bi-trash"],["alt","Immagine caricata",1,"img-thumbnail",2,"max-width","200px",3,"src"]],template:function(a,t){a&1&&(o(0,"div",7),_(1,fe,79,21,"div")(2,he,3,0,"div"),n()),a&2&&(l(),s(t.model?1:-1),l(),s(t.model?-1:2))},dependencies:[X,O,H,J,B,j,G,P,k,K,Q,L],styles:[".form-control[_ngcontent-%COMP%]:focus{border-color:#f8f9fa;box-shadow:0 0 0 .2rem #474a51}.form-select[_ngcontent-%COMP%]:focus{border-color:#f8f9fa;box-shadow:0 0 0 .2rem #474a51}"]})}}return i})();export{Ue as UpdateRecipeComponent};
