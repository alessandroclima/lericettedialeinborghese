<div class="container">
  @if (model) {
    <div>
      <h1 class="mt-3">Aggiorna ricetta esistente</h1>
      <div class="mt-3">
        <form #form="ngForm" (ngSubmit)="onSubmit()">
          <div class="mb-3">
            <label for="title" class="form-label">Titolo</label>
            <input type="text" class="form-control" id="recipeTitle" name="recipeTitle" [(ngModel)]="model.titolo"
              placeholder="Inserisci il titolo" />
            </div>
            <div class="mb-3">
              <label for="description" class="form-label">Descrizione</label>
              <input type="text" class="form-control" id="description" name="description" [(ngModel)]="model.descrizione"
                placeholder="Inserisci la descrizione" />
              </div>
              <div class="mb-3">
                <label for="cookTime" class="form-label">Tempo di cottura</label>
                <input type="text" class="form-control" id="cookTime" name="cookTime" [(ngModel)]="model.tempocottura"
                  placeholder="Inserisci il tempo di cottura" />
                </div>
                <div class="mb-3">
                  <label for="servings" class="form-label">Porzioni</label>
                  <input type="number" class="form-control" id="servings" name="servings" [(ngModel)]="model.porzioni"
                    placeholder="Inserisci il numero di porzioni" />
                  </div>
                  <div class="mb-3">
                    <label for="ingredients" class="form-label">Ingredienti</label>
                    <div class="input-group mb-3">
                      <select class="form-select" [(ngModel)]="selectedIngredient" name="selectedIngredient">
                        <option [ngValue]="undefined" disabled>Seleziona un ingrediente</option>
                        @for (ingredient of availableIngredients; track ingredient) {
                          <option [value]="ingredient.id">
                            {{ ingredient.name }}
                          </option>
                        }
                      </select>
                      <input type="text" class="form-control" placeholder="Quantità" [(ngModel)]="ingredientQuantity"
                        name="ingredientQuantity" />
                        <input type="text" class="form-control" placeholder="Unità di misura" [(ngModel)]="ingredientMeasure"
                          name="ingredientMeasure" />
                          <button type="button" class="btn btn-outline-secondary" (click)="addIngredient()">
                            +
                          </button>
                        </div>
                        <ul class="list-group">
                          @for (ingredient of model.ingredientiQuantita; track ingredient) {
                            <li
                              class="list-group-item d-flex justify-content-between align-items-center">
                              @if ((ingredient.quantita == null || ingredient.quantita == 0) && (ingredient.unitaMisura == null || ingredient.unitaMisura == '')) {
                                <span>
                                  {{ ingredient.ingredienteNome }}
                                </span>
                              }
                              @if (ingredient.quantita && ingredient.quantita !== 0) {
                                <span>
                                  {{ ingredient.ingredienteNome }} - {{ ingredient.quantita }} {{ingredient.unitaMisura}}
                                </span>
                              }
                              @if (ingredient.unitaMisura && ingredient.unitaMisura !== '' && ingredient.quantita == null || ingredient.quantita == 0) {
                                <span>
                                  {{ ingredient.ingredienteNome }} {{ingredient.unitaMisura}}
                                </span>
                              }
                              <button type="button" class="btn btn-danger btn-sm"
                                (click)="removeIngredient(ingredient.ingredienteNome)"><i class="bi bi-trash"></i></button>
                              </li>
                            }
                          </ul>
                        </div>
                        <div class="mb-3">
                          <label for="steps" class="form-label">Procedimento</label>
                          <textarea class="form-control" id="steps" name="steps" [(ngModel)]="model.procedimento"
                          placeholder="Descrivi i passaggi"></textarea>
                        </div>
                        <div class="mb-3">
                          <label>Carica un'immagine:</label>
                          <input type="file" class="form-control" (change)="onFileSelected($event)" accept="image/*" />
                          @if (model.immagineurl) {
                            <div class="mt-3">
                              <img [src]="'data:image/jpeg;base64,' + model.immagineurl" alt="Immagine caricata" class="img-thumbnail"
                                style="max-width: 200px" />
                              </div>
                            }
                          </div>
                          <button type="submit" class="btn btn-primary mb-3">Aggiorna</button>
                        </form>
                      </div>
                    </div>
                  }
                  @if (!model) {
                    <div>
                      <p>Loading...</p>
                    </div>
                  }
                </div>