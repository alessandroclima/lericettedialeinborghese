import{a as ne}from"./chunk-YM4AGZR7.js";import{a as te}from"./chunk-AFILKZVP.js";import{a as ee}from"./chunk-YBJFI6PP.js";import{a as ie}from"./chunk-2XOCPEOJ.js";import"./chunk-UISL6Y2D.js";import{a as L}from"./chunk-SNPDC4MB.js";import{a as k}from"./chunk-3455J7NY.js";import{h as P}from"./chunk-PAG5MXE5.js";import{b as U,c as Q,d as O,e as j,f as G,g as H,h as J,i as K,j as X,k as Y,l as Z,m as $}from"./chunk-XOXWJMWY.js";import{$ as g,$a as _,Ab as I,Cb as x,Db as v,Ga as q,Ia as a,Nb as f,Ob as l,Pb as T,Qb as B,Rb as D,Sb as N,T as S,Tb as h,Ub as C,Vb as b,Wa as F,_ as p,kb as y,pb as u,rb as M,sb as w,tb as E,ub as r,vb as n,wb as A}from"./chunk-XS7DYC3C.js";function oe(t,m){t&1&&(r(0,"small",27),l(1,"Il titolo \xE8 obbligatorio"),n())}function re(t,m){if(t&1&&_(0,oe,2,0,"small",27),t&2){v();let e=f(10);u(e.errors!=null&&e.errors.required?0:-1)}}function ae(t,m){t&1&&(r(0,"small",27),l(1,"Il tempo di cottura \xE8 obbligatorio"),n())}function le(t,m){if(t&1&&_(0,ae,2,0,"small",27),t&2){v();let e=f(21);u(e.errors!=null&&e.errors.required?0:-1)}}function de(t,m){t&1&&(r(0,"small",27),l(1,"Il numero di porzioni \xE8 obbligatorio"),n())}function me(t,m){if(t&1&&_(0,de,2,0,"small",27),t&2){v();let e=f(27);u(e.errors!=null&&e.errors.required?0:-1)}}function se(t,m){if(t&1&&(r(0,"option",26),l(1),n()),t&2){let e=m.$implicit;y("ngValue",e.id),a(),T(e.name)}}function ce(t,m){t&1&&(r(0,"small",27),l(1,"La categoria \xE8 obbligatoria"),n())}function pe(t,m){if(t&1&&(r(0,"option",29),l(1),n()),t&2){let e=m.$implicit;y("value",e.id),a(),T(e.name)}}function ge(t,m){t&1&&(r(0,"small",27),l(1,"Il tipo di alimentazione \xE8 obbligatoria"),n())}function ue(t,m){if(t&1&&(r(0,"option",29),l(1),n()),t&2){let e=m.$implicit;y("value",e.id),a(),T(e.name)}}function _e(t,m){t&1&&(r(0,"small",27),l(1,"Aggiungi almeno un ingrediente"),n())}function fe(t,m){if(t&1&&(r(0,"span"),l(1),n()),t&2){let e=v().$implicit;a(),B(" ",e.ingredienteNome," ")}}function he(t,m){if(t&1&&(r(0,"span"),l(1),n()),t&2){let e=v().$implicit;a(),N(" ",e.ingredienteNome," - ",e.quantita," ",e.unitaMisura," ")}}function Ce(t,m){if(t&1&&(r(0,"span"),l(1),n()),t&2){let e=v().$implicit;a(),D(" ",e.ingredienteNome," ",e.unitaMisura," ")}}function be(t,m){if(t&1){let e=I();r(0,"li",37),_(1,fe,2,1,"span")(2,he,2,3,"span")(3,Ce,2,2,"span"),r(4,"button",44),x("click",function(){let i=p(e).$implicit,d=v();return g(d.removeIngredient(i.ingredienteNome))}),A(5,"i",45),n()()}if(t&2){let e=m.$implicit;a(),u((e.quantita==null||e.quantita==0)&&(e.unitaMisura==null||e.unitaMisura=="")?1:-1),a(),u(e.quantita&&e.quantita!==0?2:-1),a(),u(e.unitaMisura&&e.unitaMisura!==""&&e.quantita==null||e.quantita==0?3:-1)}}function ve(t,m){t&1&&(r(0,"small",27),l(1,"Aggiungi almeno uno step"),n())}function Se(t,m){if(t&1&&(r(0,"div",9),A(1,"img",46),n()),t&2){let e=v();a(),y("src",e.imageUrl,q)}}var qe=(()=>{class t{constructor(){this.ingredientService=S(ie),this.categoryService=S(te),this.dietService=S(ne),this.recipeService=S(L),this.authService=S(k),this.router=S(P),this.toastr=S(ee),this.availableIngredients=[],this.availableCategories=[],this.availableDiets=[],this.selectedIngredient=void 0,this.ingredientQuantity=null,this.ingredientMeasure="",this.imageUrl=null,this.model={titolo:"",descrizione:"",tempocottura:null,porzioni:1,procedimento:"",immagineUrl:"",categoriaid:void 0,alimentazioneid:void 0,EmailAuthor:void 0,ingredientiquantita:[]}}ngOnInit(){this.authService.user().subscribe({next:e=>this.user=e}),this.user=this.authService.getUser(),this.user==null||(this.model.EmailAuthor=this.user.email),this.loadAvailableIngredients(),this.loadAvailableCategories(),this.loadAvailableDiets(),console.log(this.availableCategories)}loadAvailableIngredients(){this.ingredientService.getIngredients().subscribe(e=>{this.availableIngredients=e.sort((s,i)=>s.name.localeCompare(i.name)),console.log(this.availableIngredients)},e=>{console.error("Error fetching ingredients",e)})}loadAvailableCategories(){this.categoryService.getCategories().subscribe(e=>{this.availableCategories=e.sort((s,i)=>s.name.localeCompare(i.name))},e=>{console.error("Error fetching categories",e)})}loadAvailableDiets(){this.dietService.getDiets().subscribe(e=>{this.availableDiets=e.sort((s,i)=>s.name.localeCompare(i.name))},e=>{console.error("Error fetching categories",e)})}addIngredient(){this.selectedIngredient&&(this.model.ingredientiquantita.push({ingredienteId:this.selectedIngredient,ingredienteNome:this.availableIngredients.find(e=>e.id==this.selectedIngredient).name,quantita:this.ingredientQuantity,unitaMisura:this.ingredientMeasure}),this.selectedIngredient=void 0,this.ingredientQuantity=null,this.ingredientMeasure="")}removeIngredient(e){if(e){let s=this.model.ingredientiquantita.findIndex(i=>i.ingredienteNome===e);s!==-1&&this.model.ingredientiquantita.splice(s,1)}}onFileSelected(e){let s=e.target.files[0];if(console.log(s),s){let i=new FileReader;i.onload=d=>{this.imageUrl=d.target?.result,this.model.immagineUrl=d.target.result.split(",")[1]},i.readAsDataURL(s)}else this.imageUrl=null,this.model.immagineUrl=""}onSubmit(e){if(console.log("Form submitted",e.value),e.invalid){console.error("Form is invalid",e.errors);return}console.log("Form is valid",e.value),console.log(this.model),this.addRecipeSubscription=this.recipeService.addRecipe(this.model).subscribe({next:s=>{console.log("Recipe added"),this.toastr.success("Ricetta aggiunta con successo!","Successo"),this.router.navigate(["/admin/recipes"])},error:s=>{console.error("Error adding recipe",s)}})}ngOnDestroy(){this.addRecipeSubscription&&this.addRecipeSubscription.unsubscribe()}static{this.\u0275fac=function(s){return new(s||t)}}static{this.\u0275cmp=F({type:t,selectors:[["app-add-recipe"]],decls:80,vars:21,consts:[["form","ngForm"],["titolo","ngModel"],["tempocottura","ngModel"],["porzioni","ngModel"],["categoriaid","ngModel"],["alimentazioneid","ngModel"],["steps","ngModel"],[1,"container"],[1,"mt-3","text-center","text-orange"],[1,"mt-3"],[3,"ngSubmit"],[1,"mb-3"],["for","title",1,"form-label","text-orange","text-bold"],["type","text","id","recipeTitle","name","recipeTitle","placeholder","Inserisci il titolo","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","description",1,"form-label","text-orange","text-bold"],["type","text","id","description","name","description","placeholder","Inserisci la descrizione",1,"form-control",3,"ngModelChange","ngModel"],[1,"row","mb-3"],[1,"col-2"],["for","cookTime",1,"form-label","text-orange","text-bold"],["type","number","id","cookTime","name","cookTime","placeholder","Inserisci il tempo di cottura","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","servings",1,"form-label","text-orange","text-bold"],["type","number","id","servings","name","servings","placeholder","Inserisci il numero di porzioni","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-4"],["for","ingredients",1,"form-label","text-orange","text-bold"],["name","categoriaid","required","",1,"form-select",3,"ngModelChange","ngModel"],["disabled","","selected","",3,"ngValue"],[3,"ngValue"],[1,"text-red"],["name","alimentazioneid","required","",1,"form-select",3,"ngModelChange","ngModel"],[3,"value"],[1,"input-group","mb-3","col-12"],["name","selectedIngredient",1,"form-select",3,"ngModelChange","ngModel"],["disabled","",3,"ngValue"],["type","text","placeholder","Quantit\xE0","name","ingredientQuantity",1,"form-control",3,"ngModelChange","ngModel"],["type","text","placeholder","Unit\xE0 di misura","name","ingredientMeasure",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"list-group"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"],["for","steps",1,"form-label","text-orange","text-bold"],["id","steps","name","steps","placeholder","Descrivi gli step separandoli da un punto e virgola","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-orange","text-bold"],["type","file","accept","image/*",1,"form-control",3,"change"],["type","submit",1,"btn","btn-light","border-orange","mb-3"],[1,"fa-solid","fa-plus","me-2"],["type","button",1,"btn","btn-light","btn-sm",3,"click"],[1,"bi","bi-trash"],["alt","Immagine caricata",1,"img-thumbnail",2,"max-width","200px",3,"src"]],template:function(s,i){if(s&1){let d=I();r(0,"div",7)(1,"h1",8),l(2,"Crea nuova ricetta"),n(),r(3,"div",9)(4,"form",10,0),x("ngSubmit",function(){p(d);let o=f(5);return g(i.onSubmit(o))}),r(6,"div",11)(7,"label",12),l(8,"Titolo"),n(),r(9,"input",13,1),b("ngModelChange",function(o){return p(d),C(i.model.titolo,o)||(i.model.titolo=o),g(o)}),n(),_(11,re,1,1),n(),r(12,"div",11)(13,"label",14),l(14,"Descrizione"),n(),r(15,"input",15),b("ngModelChange",function(o){return p(d),C(i.model.descrizione,o)||(i.model.descrizione=o),g(o)}),n()(),r(16,"div",16)(17,"div",17)(18,"label",18),l(19,"Tempo di cottura"),n(),r(20,"input",19,2),b("ngModelChange",function(o){return p(d),C(i.model.tempocottura,o)||(i.model.tempocottura=o),g(o)}),n(),_(22,le,1,1),n(),r(23,"div",17)(24,"label",20),l(25,"Porzioni"),n(),r(26,"input",21,3),b("ngModelChange",function(o){return p(d),C(i.model.porzioni,o)||(i.model.porzioni=o),g(o)}),n(),_(28,me,1,1),n(),r(29,"div",22)(30,"label",23),l(31,"Categoria"),n(),r(32,"select",24,4),b("ngModelChange",function(o){return p(d),C(i.model.categoriaid,o)||(i.model.categoriaid=o),g(o)}),r(34,"option",25),l(35,"Seleziona una categoria"),n(),w(36,se,2,2,"option",26,M),n(),_(38,ce,2,0,"small",27),n(),r(39,"div",22)(40,"label",23),l(41,"Tipo di alimentazione"),n(),r(42,"select",28,5),b("ngModelChange",function(o){return p(d),C(i.model.alimentazioneid,o)||(i.model.alimentazioneid=o),g(o)}),r(44,"option",25),l(45,"Seleziona una alimentazione"),n(),w(46,pe,2,2,"option",29,M),n(),_(48,ge,2,0,"small",27),n()(),r(49,"div",11)(50,"label",23),l(51,"Ingredienti"),n(),r(52,"div",30)(53,"select",31),b("ngModelChange",function(o){return p(d),C(i.selectedIngredient,o)||(i.selectedIngredient=o),g(o)}),r(54,"option",32),l(55,"Seleziona un ingrediente"),n(),w(56,ue,2,2,"option",29,M),n(),r(58,"input",33),b("ngModelChange",function(o){return p(d),C(i.ingredientQuantity,o)||(i.ingredientQuantity=o),g(o)}),n(),r(59,"input",34),b("ngModelChange",function(o){return p(d),C(i.ingredientMeasure,o)||(i.ingredientMeasure=o),g(o)}),n(),r(60,"button",35),x("click",function(){return p(d),g(i.addIngredient())}),l(61,"+"),n()(),_(62,_e,2,0,"small",27),r(63,"ul",36),w(64,be,6,3,"li",37,M),n()(),r(66,"div",11)(67,"label",38),l(68,"Procedimento"),n(),r(69,"textarea",39,6),b("ngModelChange",function(o){return p(d),C(i.model.procedimento,o)||(i.model.procedimento=o),g(o)}),n(),_(71,ve,2,0,"small",27),n(),r(72,"div",11)(73,"label",40),l(74,"Carica un'immagine:"),n(),r(75,"input",41),x("change",function(o){return p(d),g(i.onFileSelected(o))}),n(),_(76,Se,2,1,"div",9),n(),r(77,"button",42),A(78,"i",43),l(79,"Crea"),n()()()()}if(s&2){let d=f(5),c=f(10),o=f(21),R=f(27),V=f(33),z=f(43),W=f(70);a(9),h("ngModel",i.model.titolo),a(2),u(c.invalid&&(c.touched||d.submitted)?11:-1),a(4),h("ngModel",i.model.descrizione),a(5),h("ngModel",i.model.tempocottura),a(2),u(o.invalid&&(o.touched||d.submitted)?22:-1),a(4),h("ngModel",i.model.porzioni),a(2),u(R.invalid&&(R.touched||d.submitted)?28:-1),a(4),h("ngModel",i.model.categoriaid),a(2),y("ngValue",void 0),a(2),E(i.availableCategories),a(2),u(V.invalid&&(V.touched||d.submitted)?38:-1),a(4),h("ngModel",i.model.alimentazioneid),a(2),y("ngValue",void 0),a(2),E(i.availableDiets),a(2),u(z.invalid&&(z.touched||d.submitted)?48:-1),a(5),h("ngModel",i.selectedIngredient),a(),y("ngValue",void 0),a(2),E(i.availableIngredients),a(2),h("ngModel",i.ingredientQuantity),a(),h("ngModel",i.ingredientMeasure),a(3),u(i.model.ingredientiquantita.length==0&&d.submitted?62:-1),a(2),E(i.model.ingredientiquantita),a(5),h("ngModel",i.model.procedimento),a(2),u(W.invalid&&(W.touched||d.submitted)?71:-1),a(5),u(i.imageUrl?76:-1)}},dependencies:[$,H,X,Y,U,J,K,Q,O,Z,G,j],styles:[".form-control[_ngcontent-%COMP%]:focus{border-color:#f8f9fa;box-shadow:0 0 0 .2rem #474a51}.form-select[_ngcontent-%COMP%]:focus{border-color:#f8f9fa;box-shadow:0 0 0 .2rem #474a51}"]})}}return t})();export{qe as AddRecipeComponent};
