import{a as te}from"./chunk-ZHFPKW77.js";import{a as ee}from"./chunk-HOMOVNME.js";import{a as Z}from"./chunk-AYUVLKKD.js";import{a as $}from"./chunk-JRRAZ5SC.js";import"./chunk-UISL6Y2D.js";import{a as B}from"./chunk-EAAMTQQM.js";import{a as D}from"./chunk-735NRJNZ.js";import{f as A,h as N}from"./chunk-2TPUGOKS.js";import{b as P,c as k,d as L,e as Q,f as O,g as j,h as G,i as H,j as J,k as K,l as X,m as Y}from"./chunk-Y4UBL3LJ.js";import{$ as u,$a as _,Ab as I,Cb as w,Db as m,Ga as z,Ia as l,Nb as C,Ob as d,Qb as E,Rb as q,Sb as F,T as b,Tb as h,Ub as f,Vb as x,Wa as W,_ as g,kb as v,pb as s,rb as S,sb as M,tb as y,ub as o,vb as n,wb as R}from"./chunk-BF6ZZEZH.js";function ie(i,c){i&1&&(o(0,"small",27),d(1,"Il titolo \xE8 obbligatorio"),n())}function ne(i,c){if(i&1&&_(0,ie,2,0,"small",27),i&2){m();let e=C(10);s(e.errors!=null&&e.errors.required?0:-1)}}function oe(i,c){i&1&&(o(0,"small",27),d(1,"Il tempo di cottura \xE8 obbligatorio"),n())}function ae(i,c){if(i&1&&_(0,oe,2,0,"small",27),i&2){m();let e=C(21);s(e.errors!=null&&e.errors.required?0:-1)}}function re(i,c){i&1&&(o(0,"small",27),d(1,"Il numero di porzioni \xE8 obbligatorio"),n())}function le(i,c){if(i&1&&_(0,re,2,0,"small",27),i&2){m();let e=C(27);s(e.errors!=null&&e.errors.required?0:-1)}}function de(i,c){if(i&1&&(o(0,"option",26),d(1),n()),i&2){let e=c.$implicit;v("ngValue",e.id),l(),E(" ",e.name," ")}}function ce(i,c){i&1&&(o(0,"small",27),d(1,"La categoria \xE8 obbligatoria"),n())}function me(i,c){if(i&1&&(o(0,"option",26),d(1),n()),i&2){let e=c.$implicit;v("ngValue",e.id),l(),E(" ",e.name," ")}}function se(i,c){i&1&&(o(0,"small",27),d(1,"Il tipo di alimentazione \xE8 obbligatorio"),n())}function pe(i,c){if(i&1&&(o(0,"option",34),d(1),n()),i&2){let e=c.$implicit;v("value",e.id),l(),E(" ",e.name," ")}}function ge(i,c){i&1&&(o(0,"small",27),d(1,"Aggiungi almeno un ingrediente"),n())}function ue(i,c){if(i&1&&(o(0,"span"),d(1),n()),i&2){let e=m().$implicit;l(),E(" ",e.ingredienteNome," ")}}function _e(i,c){if(i&1&&(o(0,"span"),d(1),n()),i&2){let e=m().$implicit;l(),F(" ",e.ingredienteNome," - ",e.quantita," ",e.unitaMisura," ")}}function Ce(i,c){if(i&1&&(o(0,"span"),d(1),n()),i&2){let e=m().$implicit;l(),q(" ",e.ingredienteNome," ",e.unitaMisura," ")}}function he(i,c){if(i&1){let e=I();o(0,"li",39),_(1,ue,2,1,"span")(2,_e,2,3,"span")(3,Ce,2,2,"span"),o(4,"button",46),w("click",function(){let t=g(e).$implicit,a=m(2);return u(a.removeIngredient(t.ingredienteNome))}),R(5,"i",47),n()()}if(i&2){let e=c.$implicit;l(),s((e.quantita==null||e.quantita==0)&&(e.unitaMisura==null||e.unitaMisura=="")?1:-1),l(),s(e.quantita&&e.quantita!==0?2:-1),l(),s(e.unitaMisura&&e.unitaMisura!==""&&e.quantita==null||e.quantita==0?3:-1)}}function fe(i,c){i&1&&(o(0,"small",27),d(1,"Aggiungi almeno uno step"),n())}function xe(i,c){if(i&1&&(o(0,"div",9),R(1,"img",48),n()),i&2){let e=m(2);l(),v("src","data:image/jpeg;base64,"+e.model.immagineUrl,z)}}function be(i,c){if(i&1){let e=I();o(0,"div")(1,"h1",8),d(2,"Aggiorna ricetta esistente"),n(),o(3,"div",9)(4,"form",10,0),w("ngSubmit",function(){g(e);let t=C(5),a=m();return u(a.onSubmit(t))}),o(6,"div",11)(7,"label",12),d(8,"Titolo"),n(),o(9,"input",13,1),x("ngModelChange",function(t){g(e);let a=m();return f(a.model.titolo,t)||(a.model.titolo=t),u(t)}),n(),_(11,ne,1,1),n(),o(12,"div",11)(13,"label",14),d(14,"Descrizione"),n(),o(15,"input",15),x("ngModelChange",function(t){g(e);let a=m();return f(a.model.descrizione,t)||(a.model.descrizione=t),u(t)}),n()(),o(16,"div",16)(17,"div",17)(18,"label",18),d(19,"Tempo di cottura"),n(),o(20,"input",19,2),x("ngModelChange",function(t){g(e);let a=m();return f(a.model.tempocottura,t)||(a.model.tempocottura=t),u(t)}),n(),_(22,ae,1,1),n(),o(23,"div",17)(24,"label",20),d(25,"Porzioni"),n(),o(26,"input",21,3),x("ngModelChange",function(t){g(e);let a=m();return f(a.model.porzioni,t)||(a.model.porzioni=t),u(t)}),n(),_(28,le,1,1),n(),o(29,"div",22)(30,"label",23),d(31,"Categoria"),n(),o(32,"select",24,4),x("ngModelChange",function(t){g(e);let a=m();return f(a.model.categoriaid,t)||(a.model.categoriaid=t),u(t)}),o(34,"option",25),d(35,"Seleziona una categoria"),n(),M(36,de,2,2,"option",26,S),n(),_(38,ce,2,0,"small",27),n(),o(39,"div",22)(40,"label",28),d(41,"Tipo di alimentazione"),n(),o(42,"select",29,5),x("ngModelChange",function(t){g(e);let a=m();return f(a.model.alimentazioneid,t)||(a.model.alimentazioneid=t),u(t)}),o(44,"option",25),d(45,"Seleziona una alimentazione"),n(),M(46,me,2,2,"option",26,S),n(),_(48,se,2,0,"small",27),n()(),o(49,"div",11)(50,"label",30),d(51,"Ingredienti"),n(),o(52,"div",31)(53,"select",32),x("ngModelChange",function(t){g(e);let a=m();return f(a.selectedIngredient,t)||(a.selectedIngredient=t),u(t)}),o(54,"option",33),d(55,"Seleziona un ingrediente"),n(),M(56,pe,2,2,"option",34,S),n(),o(58,"input",35),x("ngModelChange",function(t){g(e);let a=m();return f(a.ingredientQuantity,t)||(a.ingredientQuantity=t),u(t)}),n(),o(59,"input",36),x("ngModelChange",function(t){g(e);let a=m();return f(a.ingredientMeasure,t)||(a.ingredientMeasure=t),u(t)}),n(),o(60,"button",37),w("click",function(){g(e);let t=m();return u(t.addIngredient())}),d(61," + "),n()(),_(62,ge,2,0,"small",27),o(63,"ul",38),M(64,he,6,3,"li",39,S),n()(),o(66,"div",11)(67,"label",40),d(68,"Procedimento"),n(),o(69,"textarea",41,6),x("ngModelChange",function(t){g(e);let a=m();return f(a.model.procedimento,t)||(a.model.procedimento=t),u(t)}),n(),_(71,fe,2,0,"small",27),n(),o(72,"div",11)(73,"label",42),d(74,"Carica un'immagine:"),n(),o(75,"input",43),w("change",function(t){g(e);let a=m();return u(a.onFileSelected(t))}),n(),_(76,xe,2,1,"div",9),n(),o(77,"button",44),R(78,"i",45),d(79,"Aggiorna"),n()()()()}if(i&2){let e=C(5),r=C(10),t=C(21),a=C(27),T=C(33),U=C(43),V=C(70),p=m();l(9),h("ngModel",p.model.titolo),l(2),s(r.invalid&&(r.touched||e.submitted)?11:-1),l(4),h("ngModel",p.model.descrizione),l(5),h("ngModel",p.model.tempocottura),l(2),s(t.invalid&&(t.touched||e.submitted)?22:-1),l(4),h("ngModel",p.model.porzioni),l(2),s(a.invalid&&(a.touched||e.submitted)?28:-1),l(4),h("ngModel",p.model.categoriaid),l(2),v("ngValue",void 0),l(2),y(p.availableCategories),l(2),s(T.invalid&&(T.touched||e.submitted)?38:-1),l(4),h("ngModel",p.model.alimentazioneid),l(2),v("ngValue",void 0),l(2),y(p.availableDiets),l(2),s(U.invalid&&(U.touched||e.submitted)?48:-1),l(5),h("ngModel",p.selectedIngredient),l(),v("ngValue",void 0),l(2),y(p.availableIngredients),l(2),h("ngModel",p.ingredientQuantity),l(),h("ngModel",p.ingredientMeasure),l(3),s(p.model.ingredientiquantita.length==0&&e.submitted?62:-1),l(2),y(p.model.ingredientiquantita),l(5),h("ngModel",p.model.procedimento),l(2),s(V.invalid&&(V.touched||e.submitted)?71:-1),l(5),s(p.model.immagineUrl?76:-1)}}function ve(i,c){i&1&&(o(0,"div")(1,"p"),d(2,"Loading..."),n()())}var qe=(()=>{class i{removeIngredient(e){if(e){let r=this.model.ingredientiquantita.findIndex(t=>t.ingredienteNome===e);r!==-1&&this.model?.ingredientiquantita.splice(r,1)}}onFileSelected(e){let r=e.target.files[0];if(console.log(r),r){let t=new FileReader;t.onload=a=>{this.model.immagineUrl=a.target.result.split(",")[1]},t.readAsDataURL(r)}else this.model.immagineUrl=""}addIngredient(){console.log("Adding ingredient"),console.log(this.availableIngredients.find(e=>e.id==this.selectedIngredient).name),this.selectedIngredient&&(this.model?.ingredientiquantita.push({ingredienteId:this.selectedIngredient,quantita:Number.parseFloat(this.ingredientQuantity.toString().replace(",",".")),ingredienteNome:this.availableIngredients.find(e=>e.id==this.selectedIngredient).name,unitaMisura:this.ingredientMeasure}),this.selectedIngredient=void 0,this.ingredientQuantity=null,this.ingredientMeasure="")}onSubmit(e){if(console.log("Form submitted",e.value),e.invalid){console.error("Form is invalid",e.errors);return}console.log("Form is valid",e.value),this.user?.email!==void 0&&(this.model.EmailAuthor=this.user.email),this.model&&(this.updateRecipeSubscription=this.recipeService.updateRecipe(this.model).subscribe({next:()=>{console.log("Recipe updated"),this.toastr.success("Ricetta aggiornata con successo!","Successo"),this.router.navigate(["/admin/recipes"])}}))}constructor(){this.ingredientService=b($),this.recipeService=b(B),this.router=b(N),this.route=b(A),this.categoryService=b(ee),this.dietService=b(te),this.authService=b(D),this.toastr=b(Z),this.availableIngredients=[],this.availableCategories=[],this.availableDiets=[],this.selectedIngredient=void 0,this.ingredientQuantity=null,this.ingredientMeasure="",this.imageUrl=null,this.getRecipeModel=void 0,this.recipeId=null,this.model={id:"",titolo:"",descrizione:"",tempocottura:0,porzioni:0,procedimento:"",immagineUrl:"",categoriaid:0,alimentazioneid:0,EmailAuthor:"",ingredientiquantita:[]}}ngOnInit(){this.authService.user().subscribe({next:e=>this.user=e}),this.user=this.authService.getUser(),console.log(this.user?.username),this.recipeId=this.route.snapshot.paramMap.get("id"),this.recipeId&&(this.loadIngredients(),this.loadAvailableCategories(),this.loadAvailableDiets(),this.loadRecipe(this.recipeId))}loadRecipe(e){this.getDetailsSubscription=this.recipeService.getRecipeDetails(e).subscribe({next:r=>{console.log("Recipe loaded"),console.log(r),this.getRecipeModel=r,this.model.id=this.getRecipeModel.id,this.model.titolo=this.getRecipeModel.titolo,this.model.descrizione=this.getRecipeModel.descrizione,this.model.tempocottura=this.getRecipeModel.tempocottura,this.model.porzioni=this.getRecipeModel.porzioni,this.model.procedimento=this.getRecipeModel.procedimento,this.model.immagineUrl=this.getRecipeModel.immagineurl,this.model.categoriaid=this.availableCategories.find(t=>t.name==this.getRecipeModel?.categorianome).id,this.model.alimentazioneid=this.availableDiets.find(t=>t.name==this.getRecipeModel?.alimentazionenome).id,this.model.ingredientiquantita=this.getRecipeModel?.ingredientiQuantita.map(t=>({ingredienteId:t.ingredienteId,quantita:t.quantita,ingredienteNome:t.ingredienteNome,unitaMisura:t.unitaMisura}))},error:r=>{console.error("Error loading recipe",r)}})}loadIngredients(){this.getIngredientsSubscription=this.ingredientService.getIngredients().subscribe({next:e=>{console.log("Ingredients loaded"),console.log(e),this.availableIngredients=e.sort((r,t)=>r.name.localeCompare(t.name))},error:e=>{console.error("Error loading ingredients",e)}})}loadAvailableCategories(){this.categoryService.getCategories().subscribe(e=>{this.availableCategories=e.sort((r,t)=>r.name.localeCompare(t.name))},e=>{console.error("Error fetching categories",e)})}loadAvailableDiets(){this.dietService.getDiets().subscribe(e=>{this.availableDiets=e.sort((r,t)=>r.name.localeCompare(t.name))},e=>{console.error("Error fetching categories",e)})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=W({type:i,selectors:[["app-update-recipe"]],decls:3,vars:2,consts:[["form","ngForm"],["titolo","ngModel"],["tempocottura","ngModel"],["porzioni","ngModel"],["categoriaid","ngModel"],["alimentazioneid","ngModel"],["steps","ngModel"],[1,"container"],[1,"mt-3","text-center","text-orange"],[1,"mt-3"],[3,"ngSubmit"],[1,"mb-3"],["for","title",1,"form-label","text-bold","text-orange"],["type","text","id","recipeTitle","name","recipeTitle","placeholder","Inserisci il titolo","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","description",1,"form-label","text-bold","text-orange"],["type","text","id","description","name","description","placeholder","Inserisci la descrizione",1,"form-control",3,"ngModelChange","ngModel"],[1,"row","mb-3"],[1,"col-2"],["for","cookTime",1,"form-label","text-bold","text-orange"],["type","text","id","cookTime","name","cookTime","placeholder","Inserisci il tempo di cottura","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","servings",1,"form-label","text-bold","text-orange"],["type","number","id","servings","name","servings","placeholder","Inserisci il numero di porzioni","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-4"],["for","categories",1,"form-label","text-bold","text-orange"],["name","categoriaid","required","",1,"form-select",3,"ngModelChange","ngModel"],["disabled","","selected","",3,"ngValue"],[3,"ngValue"],[1,"text-red"],["for","diet",1,"form-label","text-bold","text-orange"],["name","alimentazioneid","required","",1,"form-select",3,"ngModelChange","ngModel"],["for","ingredients",1,"form-label","text-bold","text-orange"],[1,"input-group","mb-3"],["name","selectedIngredient",1,"form-select",3,"ngModelChange","ngModel"],["disabled","",3,"ngValue"],[3,"value"],["type","text","placeholder","Quantit\xE0","name","ingredientQuantity",1,"form-control",3,"ngModelChange","ngModel"],["type","text","placeholder","Unit\xE0 di misura","name","ingredientMeasure",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"list-group"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"],["for","steps",1,"form-label","text-bold","text-orange"],["id","steps","name","steps","placeholder","Descrivi i vari step separandoli da un punto e virgola","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-label","text-bold","text-orange"],["type","file","accept","image/*",1,"form-control",3,"change"],["type","submit",1,"btn","btn-light","border-orange","mb-3"],[1,"bi","bi-pencil","me-2"],["type","button",1,"btn","btn-light","btn-sm",3,"click"],[1,"bi","bi-trash"],["alt","Immagine caricata",1,"img-thumbnail",2,"max-width","200px",3,"src"]],template:function(r,t){r&1&&(o(0,"div",7),_(1,be,80,21,"div")(2,ve,3,0,"div"),n()),r&2&&(l(),s(t.model?1:-1),l(),s(t.model?-1:2))},dependencies:[Y,j,J,K,P,G,H,k,L,X,O,Q],styles:[".form-control[_ngcontent-%COMP%]:focus{border-color:#f8f9fa;box-shadow:0 0 0 .2rem #474a51}.form-select[_ngcontent-%COMP%]:focus{border-color:#f8f9fa;box-shadow:0 0 0 .2rem #474a51}"]})}}return i})();export{qe as UpdateRecipeComponent};
