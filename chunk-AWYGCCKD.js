import{a as U}from"./chunk-YBJFI6PP.js";import"./chunk-UISL6Y2D.js";import{a as Q}from"./chunk-SNPDC4MB.js";import{a as B}from"./chunk-3455J7NY.js";import{f as z,i as P}from"./chunk-PAG5MXE5.js";import{b as $,c as O,f as j,m as q}from"./chunk-XOXWJMWY.js";import{$ as g,$a as f,Ab as v,Bc as A,Cb as u,Db as d,Fc as N,Ga as w,Ia as r,Na as E,Ob as a,Pb as x,Qb as C,T as b,Tb as M,Ub as F,Vb as I,Wa as L,Xb as y,Yb as k,Zb as V,_,kb as m,pb as h,rb as S,sb as R,tb as T,ub as n,vb as o,wb as c,yc as D}from"./chunk-XS7DYC3C.js";var G=()=>["/admin/recipes/add"],W=i=>["/admin/recipes",i],H=(i,s)=>["/admin/recipes/update",i,s],J=()=>({"background-color":"#e84919","border-color":"#e84919",color:"white"}),K=()=>({color:"#e84919"});function X(i,s){i&1&&(n(0,"div",19)(1,"a",28),c(2,"i",29),a(3,"Nuova Ricetta "),o()()),i&2&&(r(),m("routerLink",y(1,G)))}function Y(i,s){i&1&&c(0,"i",44)}function Z(i,s){i&1&&c(0,"i",44)}function ee(i,s){i&1&&c(0,"i",45)}function te(i,s){if(i&1){let e=v();n(0,"button",50),u("click",function(){_(e);let l=d().$implicit,p=d(2);return g(p.openDeleteModal(l.id))}),c(1,"i",51),o()}}function ie(i,s){if(i&1&&(n(0,"button",47),c(1,"i",52),o()),i&2){let e=d().$implicit;m("routerLink",V(1,H,e.author,e.id))}}function ne(i,s){if(i&1&&(n(0,"div",21)(1,"div",30)(2,"a",31),c(3,"img",32),o()(),n(4,"div",33)(5,"div",34)(6,"div")(7,"p",35)(8,"span"),c(9,"i",36),n(10,"strong",37),a(11),o()(),n(12,"span",38),c(13,"i",39),a(14),c(15,"i",40),a(16,"5 "),o()(),n(17,"p")(18,"strong",37),a(19),o()(),n(20,"p"),a(21),o()(),n(22,"div",41)(23,"p",35)(24,"span"),c(25,"i",42)(26,"strong",37),a(27),c(28,"i",43)(29,"strong",37),a(30),f(31,Y,1,0,"i",44)(32,Z,1,0,"i",44)(33,ee,1,0,"i",45),o(),n(34,"span"),f(35,te,2,0,"button",46)(36,ie,2,4,"button",47),n(37,"button",48),c(38,"i",49),o()()()()()()()),i&2){let e=s.$implicit,t=d(2);r(2),m("routerLink",k(12,W,e.id)),r(),m("src","data:image/jpeg;base64,"+e.immagineurl,w),r(8),x(e.categorianome),r(3),C("",e.recipeUser.length," "),r(5),x(e.titolo),r(2),x(e.descrizione),r(6),C("",e.tempocottura," "),r(3),C("",e.porzioni," "),r(),h(e.alimentazionenome=="Vegetariana"?31:e.alimentazionenome=="Vegana"?32:e.alimentazionenome=="Celiaca"?33:-1),r(4),h(t.user!==void 0&&t.user.roles.includes("Admin")?35:-1),r(),h(t.user!==void 0&&t.user.roles.includes("writer")&&t.user.username===e.author?36:-1),r(),m("routerLink",k(14,W,e.id))}}function oe(i,s){if(i&1){let e=v();n(0,"li",24)(1,"button",53),u("click",function(){let l=_(e).$index,p=d(2);return g(p.goToPage(l+1))}),a(2),o()()}if(i&2){let e=s.$index,t=d(2);m("ngClass",t.pageNumber==e+1?"page-item active":"page-item"),r(),m("ngStyle",t.pageNumber==e+1?y(3,J):y(4,K)),r(),x(e+1)}}function re(i,s){if(i&1){let e=v();n(0,"div")(1,"div",11)(2,"h1",12),a(3,"Tutte le ricette di Ale in borghese"),o(),n(4,"div",13)(5,"div",14)(6,"div",15)(7,"input",16),I("ngModelChange",function(l){_(e);let p=d();return F(p.filterText,l)||(p.filterText=l),g(l)}),u("input",function(){_(e);let l=d();return g(l.onFilterTitle())}),o(),n(8,"button",17),c(9,"i",18),o()()(),f(10,X,4,2,"div",19),o(),n(11,"ul",20),R(12,ne,39,16,"div",21,S),o(),n(14,"nav",22)(15,"ul",23)(16,"li",24)(17,"a",25),u("click",function(){_(e);let l=d();return g(l.goToPage(l.pageNumber-1))}),n(18,"span",26),a(19,"\xAB"),o()()(),R(20,oe,3,5,"li",24,S),n(22,"li",24)(23,"a",27),u("click",function(){_(e);let l=d();return g(l.goToPage(l.pageNumber+1))}),n(24,"span",26),a(25,"\xBB"),o()()()()()()()}if(i&2){let e=d();r(7),M("ngModel",e.filterText),r(3),h(e.user!==void 0?10:-1),r(2),T(e.filteredRecipes),r(4),m("ngClass",e.pageNumber==1?"page-item disabled":"page-item"),r(4),T(e.list),r(2),m("ngClass",e.pageNumber==e.list.length?"page-item disabled":"page-item")}}function le(i,s){if(i&1&&(n(0,"div",10),a(1),o()),i&2){let e=d();r(),C(" \u26A0\uFE0F ",e.errorMessage,`
`)}}var fe=(()=>{class i{constructor(){this.authService=b(B),this.recipeService=b(Q),this.route=b(z),this.renderer=b(E),this.toastr=b(U),this.availableRecipes=[],this.errorMessage=null,this.filteredRecipes=[],this.filterText="",this.searchQuery="",this.categoryQuery="",this.recipesCount=0,this.pageNumber=1,this.pageSize=5,this.list=[],this.recipeIdToDelete=null}deleteRecipe(e){this.deleteRecipeSubscription=this.recipeService.deleteRecipe(e).subscribe({next:t=>{console.log("Recipe deleted",t),this.loadRecipes()},error:t=>{console.error("Error deleting recipe",t),this.errorMessage=t.message},complete:()=>console.log("Chiamata API completata")})}editRecipe(e){throw new Error("Method not implemented.")}openDeleteModal(e){this.recipeIdToDelete=e;let t=document.getElementById("deleteModal");t&&(this.renderer.addClass(t,"show"),this.renderer.setStyle(t,"display","block"),this.renderer.setAttribute(t,"aria-modal","true"),this.renderer.setAttribute(t,"role","dialog"))}closeDeleteModal(){let e=document.getElementById("deleteModal");e&&(this.renderer.removeClass(e,"show"),this.renderer.setStyle(e,"display","none"),this.renderer.removeAttribute(e,"aria-modal"),this.renderer.removeAttribute(e,"role"))}confirmDelete(){this.recipeIdToDelete!==null&&this.recipeService.deleteRecipe(this.recipeIdToDelete).subscribe(()=>{this.loadRecipes(),this.recipeIdToDelete=null,this.closeDeleteModal()},e=>{this.errorMessage="Errore nell'eliminazione della ricetta"})}showToast(){console.log("Click sul bottone, mostro toast"),this.toastr.success("Test toast visibile!","Successo")}ngOnInit(){this.authService.user().subscribe({next:e=>this.user=e}),this.user=this.authService.getUser(),this.route.queryParams.subscribe(e=>{this.searchQuery=e.query||"",this.categoryQuery=e.category||"",this.recipeService.getRecipesCount(this.categoryQuery,this.searchQuery).subscribe({next:t=>{this.recipesCount=t,console.log("Total recipes count:",t),t<5?this.pageSize=t:this.pageSize=5,this.list=new Array(Math.ceil(t/this.pageSize)),this.loadRecipes()},error:t=>{console.error("Error loading recipes count",t)}})})}loadRecipes(){this.getRecipeSubscription=this.recipeService.getRecipes(this.categoryQuery,this.searchQuery,void 0,void 0,this.pageNumber,this.pageSize).subscribe({next:e=>{this.availableRecipes=e,this.filteredRecipes=this.availableRecipes,console.log(this.availableRecipes)},error:e=>{console.error("Error fetching recipes",e),this.errorMessage=e.message},complete:()=>console.log("Chiamata API completata")})}goToPage(e){this.pageNumber=e,this.loadRecipes()}onFilterTitle(){this.filterText.trim()===""?this.filteredRecipes=this.availableRecipes:this.filteredRecipes=this.availableRecipes.filter(e=>e.titolo.toLowerCase().includes(this.filterText.toLowerCase()))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=L({type:i,selectors:[["app-recipe-list"]],decls:16,vars:2,consts:[["id","deleteModal","tabindex","-1","aria-labelledby","deleteModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","deleteModalLabel",1,"modal-title","text-orange"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"],[1,"error"],[1,"container"],[1,"mt-3",2,"color","#e84919"],[1,"row","align-items-center","mb-3","mt-4"],[1,"col-12","col-md-5","mb-2","mb-md-0"],[1,"input-group"],["type","text","placeholder","Filtra ricette...",1,"form-control",3,"ngModelChange","input","ngModel"],["type","button",1,"btn","btn-light","border-orange"],[1,"fa-solid","fa-magnifying-glass",2,"color","#e84919"],[1,"col-12","col-md-3","text-md-end"],[1,"list-group","mb-4"],[1,"row","g-0","mt-4"],["aria-label","Page navigation example"],[1,"pagination"],[3,"ngClass"],["aria-label","Previous",1,"page-link",2,"color","#e84919",3,"click"],["aria-hidden","true"],["aria-label","Next",1,"page-link",2,"color","#e84919",3,"click"],[1,"btn","btn-light","w-100","w-md-auto",2,"border-color","#e84919",3,"routerLink"],[1,"fa-solid","fa-plus","me-1"],[1,"col-12","col-md-3"],[1,"text-decoration-none",3,"routerLink"],["alt","...",1,"img-fluid","d-block","w-100",2,"width","485px","height","250px",3,"src"],[1,"col-12","col-md-5","d-flex","flex-column",2,"background-color","rgba(247, 246, 248, 1)"],[1,"p-2","d-flex","flex-column","h-100"],[1,"d-flex","justify-content-between","align-items-center"],[1,"fa-solid","fa-bowl-rice","me-2"],[2,"color","#e84919"],[1,"me-2"],[1,"bi","bi-chat-left-heart-fill","me-1"],[1,"fa-solid","fa-star","ms-2","me-1",2,"color","gold"],[1,"px-2","pt-2","mt-auto"],[1,"bi","bi-clock-fill","me-2"],[1,"fa-solid","fa-people-group","ms-4","me-2"],[1,"fa-solid","fa-leaf","ms-4","me-2"],[1,"fa-solid","fa-bread-slice","ms-4","me-2"],[1,"btn","btn-light","btn-sm","me-2"],[1,"btn","btn-light","btn-sm","me-2",3,"routerLink"],[1,"btn","btn-light","btn-sm",3,"routerLink"],[1,"bi","bi-book"],[1,"btn","btn-light","btn-sm","me-2",3,"click"],[1,"bi","bi-trash"],[1,"bi","bi-pencil"],[1,"page-link",3,"click","ngStyle"]],template:function(t,l){t&1&&(f(0,re,26,4,"div"),n(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"h5",4),a(6,"Conferma eliminazione"),o(),n(7,"button",5),u("click",function(){return l.closeDeleteModal()}),o()(),n(8,"div",6),a(9," Sei sicuro di voler eliminare questa ricetta? "),o(),n(10,"div",7)(11,"button",8),u("click",function(){return l.closeDeleteModal()}),a(12,"Annulla"),o(),n(13,"button",9),u("click",function(){return l.confirmDelete()}),a(14,"Elimina"),o()()()()(),f(15,le,2,1,"div",10)),t&2&&(h(l.errorMessage?-1:0),r(15),h(l.errorMessage?15:-1))},dependencies:[q,$,O,j,P,N,D,A],styles:[".btn-transparent.dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.form-control[_ngcontent-%COMP%]:focus{border-color:#e84919;box-shadow:0 0 0 .2rem #e8491940}.container[_ngcontent-%COMP%]{overflow-x:hidden}"]})}}return i})();export{fe as RecipeListComponent};
